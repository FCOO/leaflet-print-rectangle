!function(a,b,c,d,e){"use strict";var f=1,g=2,h=4,i=8,j=16,k=32,l={stroke:!0,color:"white",weight:2,opacity:1,fill:!0,fillColor:"white",fillOpacity:.1,clickable:!0},m="leaflet-print-rectangle";b.PrintRectangle=b.Class.extend({includes:b.Mixin.Events,options:{VERSION:"1.1.1",ratio:1.5,allowRotate:!0,markerDim:20},initialize:function(a){b.setOptions(this,a),this.initSizeRatio=.9,this.minimumDim=3.6*this.options.markerDim,this.whRatio=this.options.ratio},addTo:function(a){this._map=a;var c=a.getBounds();this.polygon=new b.polygon([c.getSouthWest(),c.getNorthWest(),c.getNorthEast(),c.getSouthEast()],l);var d,e,m,n=[f,g,h],o=["left","center","right"],p=[i,j,k],q=["top","middle","bottom"],r={icon:null,clickable:!0,draggable:!0,keyboard:!0},s={iconSize:[this.options.markerDim,this.options.markerDim],iconAnchor:[0,0],className:""};this.resizeMarkers=[],this.featureGroup=b.featureGroup();for(var t=function(a,b){this.setLatLng(this._map.containerPointToLatLng([a,b]))},u=0;u<n.length;u++)for(var v=0;v<p.length;v++){var w=n[u]+p[v];w&f&&(d=0+l.weight),w&g&&(d=this.options.markerDim/2),w&h&&(d=this.options.markerDim-l.weight),w&i&&(e=0+l.weight),w&j&&(e=this.options.markerDim/2),w&k&&(e=this.options.markerDim-l.weight),s.iconAnchor=[d,e],s.className="lpr-marker "+o[u]+" "+q[v],r.icon=b.divIcon(s),m=b.marker([0,0],r),m.type=w,m._map=this._map,m.on("dragstart",this._marker_onDragStart,this),m.on("drag",this._marker_onDrag,this),m.on("dragend",this._marker_onDragEnd,this),m._setPosByLeftTop=t,this.resizeMarkers[w]=m,this.featureGroup.addLayer(m)}return this.centerMarker=this.resizeMarkers[g+j],this.fixedMarker=this.centerMarker,this._container=b.DomUtil.create("div","lpr-container",this._map._controlContainer),this._topShade=b.DomUtil.create("div","lpr-shade",this._container),this._bottomShade=b.DomUtil.create("div","lpr-shade",this._container),this._leftShade=b.DomUtil.create("div","lpr-shade",this._container),this._rightShade=b.DomUtil.create("div","lpr-shade",this._container),this},show:function(){a("html").removeClass("no-"+m),a("html").addClass(m),this.polygon.addTo(this._map),this.polygon.bringToFront(),this.featureGroup.addTo(this._map),a(this._container).show(),b.DomEvent.addListener(this._container,"contextmenu",b.DomEvent.stop);var c=this._map.getPixelBounds();this.pixelWidth=this.initSizeRatio*c.getSize().x,this.pixelHeight=this.initSizeRatio*c.getSize().y,this.pixelWidth>this.pixelHeight*this.whRatio?this.pixelWidth=this.pixelHeight*this.whRatio:this.pixelHeight=this.pixelWidth/this.whRatio,this.center=(c.max.x-c.min.x)/2,this.middle=(c.max.y-c.min.y)/2,this._update(),this.setRatio(this.whRatio),this.options.allowRotate&&this._map.on("click",this.rotate,this),this._map.on("drag",this._onMapChange,this),this._map.on("zoomend",this._onMapZoom,this),this._map.on("moveend",this._onMapChange,this),this._map.on("resize",this._onMapChange,this),this._map.freeze({allowZoomAndPan:!0,allowClick:!0})},hide:function(){a("html").removeClass(m),a("html").addClass("no-"+m),this._map.off("zoomend",this._onMapZoom,this),this._map.off("moveend",this._onMapChange,this),this._map.off("resize",this._onMapChange,this),this._map.off("drag",this._onMapChange,this),this.options.allowRotate&&this._map.off("click",this.rotate,this),this._map.removeLayer(this.featureGroup),this._map.removeLayer(this.polygon),a(this._container).hide(),this._map.thaw()},remove:function(){this.hide(),this._container.remove()},setRatio:function(a,b){b&&(this.isLandscape&&1>a||!this.isLandscape&&a>=1)&&(a=1/a),this.whRatio=a,this.isLandscape=a>=1,this._calcPointBounds(),this.whRatio>1?(this.minHeight=this.minimumDim,this.minWidth=this.minHeight*this.whRatio):(this.minWidth=this.minimumDim,this.minHeight=this.minWidth/this.whRatio);var c=Math.max(this.pixelWidth,this.pixelHeight);this.whRatio<1?(this.pixelHeight=c,this.pixelWidth=this.pixelHeight*this.whRatio):(this.pixelWidth=c,this.pixelHeight=this.pixelWidth/this.whRatio),this._calcDrawPointBounds(),this.pixelHeight=Math.max(this.minHeight,Math.min(this.pixelHeight,this.dragHeight)),this.pixelWidth=Math.max(this.minWidth,Math.min(this.pixelWidth,this.dragWidth)),this.pixelWidth>this.pixelHeight*this.whRatio?this.pixelWidth=this.pixelHeight*this.whRatio:this.pixelHeight=this.pixelWidth/this.whRatio,this._update(),this.maxBounds.contains(this.polygon.getBounds())||(this.middle=this.middle+Math.max(0,this.dragTop-this.top)-Math.max(0,this.bottom-this.dragBottom),this.center=this.center+Math.max(0,this.dragLeft-this.left)-Math.max(0,this.right-this.dragRight),this._update())},rotate:function(){this.setRatio(1/this.whRatio)},_update:function(){function a(a,b){a.style.display=b.width>0&&b.height>0?"block":"none",a.style.width=b.width+"px",a.style.height=b.height+"px",a.style.top=b.top+"px",a.style.left=b.left+"px",a.style.bottom=b.bottom+"px",a.style.right=b.right+"px"}var b=this.fixedMarker.type,c=this.pixelHeight/2,d=this.pixelWidth/2;b&j&&(this.top=this.middle-c,this.bottom=this.middle+c),b&g&&(this.left=this.center-d,this.right=this.center+d),b&i&&(this.bottom=this.top+this.pixelHeight),b&k&&(this.top=this.bottom-this.pixelHeight),b&f&&(this.right=this.left+this.pixelWidth),b&h&&(this.left=this.right-this.pixelWidth),this.center=this.left+(this.right-this.left)/2,this.middle=this.top+(this.bottom-this.top)/2,this.southWest=this._map.containerPointToLatLng([this.left,this.bottom]),this.northWest=this._map.containerPointToLatLng([this.left,this.top]),this.northEast=this._map.containerPointToLatLng([this.right,this.top]),this.southEast=this._map.containerPointToLatLng([this.right,this.bottom]),this.polygon.setLatLngs([this.southWest,this.northWest,this.northEast,this.southEast]),this.resizeMarkers[f+i]._setPosByLeftTop(this.left,this.top),this.resizeMarkers[f+k]._setPosByLeftTop(this.left,this.bottom),this.resizeMarkers[h+i]._setPosByLeftTop(this.right,this.top),this.resizeMarkers[h+k]._setPosByLeftTop(this.right,this.bottom),this.resizeMarkers[f+j]._setPosByLeftTop(this.left,this.middle),this.resizeMarkers[h+j]._setPosByLeftTop(this.right,this.middle),this.resizeMarkers[g+i]._setPosByLeftTop(this.center,this.top),this.resizeMarkers[g+k]._setPosByLeftTop(this.center,this.bottom),this.resizeMarkers[g+j]._setPosByLeftTop(this.center,this.middle);var e=this._map.getSize();a(this._topShade,{width:e.x,height:this.top,top:0,left:0}),a(this._bottomShade,{width:e.x,height:e.y-this.bottom,bottom:0,left:0}),a(this._leftShade,{width:this.left,height:this.pixelHeight,top:this.top,left:0}),a(this._rightShade,{width:e.x-this.right,height:this.pixelHeight,top:this.top,right:0})},_calcPointBounds:function(){var a=this._map.latLngToContainerPoint(this.polygon.getBounds().getNorthWest()),b=this._map.latLngToContainerPoint(this.polygon.getBounds().getSouthEast());this.left=a.x,this.top=a.y,this.right=b.x,this.bottom=b.y,this.center=this.left+(this.right-this.left)/2,this.middle=this.top+(this.bottom-this.top)/2,this.pixelWidth=this.right-this.left,this.pixelHeight=this.bottom-this.top},_calcDrawPointBounds:function(){this.maxBounds=this._map.options.maxBounds?this._map.options.maxBounds:b.latLngBounds([-90,180],[90,-180]);var a=this._map.latLngToContainerPoint(this.maxBounds.getNorthWest()),c=this._map.latLngToContainerPoint(this.maxBounds.getSouthEast());this.dragLeft=a.x,this.dragTop=a.y,this.dragRight=c.x,this.dragBottom=c.y,this.dragWidth=this.dragRight-this.dragLeft,this.dragHeight=this.dragBottom-this.dragTop},_onMapChange:function(){this._calcPointBounds(),this._update()},_onMapZoom:function(){this.setRatio(this.whRatio)},_marker_onDragStart:function(a){this.dragMarker=a.target,this.isMoving=this.dragMarker==this.centerMarker,this._calcPointBounds(),this._calcDrawPointBounds();var c,d,e,l,m=this.pixelHeight/2,n=this.pixelWidth/2;this.isMoving?(this.dragLeft+=n,this.dragTop+=m,this.dragRight-=n,this.dragBottom-=m):(c=this.dragMarker.type,d=(c&g+j)+(c&i?k:0)+(c&k?i:0)+(c&f?h:0)+(c&h?f:0),this.fixedMarker=this.resizeMarkers[d],c=a.target.type,c&i&&(e=this.pixelHeight+this.top-this.dragTop),c&k&&(e=this.pixelHeight+this.dragBottom-this.bottom),c&j&&(e=this.pixelHeight+2*Math.min(this.top-this.dragTop,this.dragBottom-this.bottom)),c&f&&(l=this.pixelWidth+this.left-this.dragLeft),c&h&&(l=this.pixelWidth+this.dragRight-this.right),c&g&&(l=this.pixelWidth+2*Math.min(this.left-this.dragLeft,this.dragRight-this.right)),l>e*this.whRatio?l=e*this.whRatio:e=l/this.whRatio,c&i&&(this.dragBottom=this.bottom-this.minHeight,this.dragTop=this.bottom-e),c&k&&(this.dragTop=this.top+this.minHeight,this.dragBottom=this.top+e),c&f&&(this.dragLeft=this.right-l,this.dragRight=this.right-this.minWidth),c&h&&(this.dragLeft=this.left+this.minWidth,this.dragRight=this.left+l),c&g&&(this.dragLeft=this.center,this.dragRight=this.center),c&j&&(this.dragTop=this.middle,this.dragBottom=this.middle)),this.dragBounds=b.latLngBounds(this._map.containerPointToLatLng([this.dragLeft,this.dragBottom]),this._map.containerPointToLatLng([this.dragRight,this.dragTop]))},_marker_onDrag:function(a){var b=a.target.getLatLng();if(this.dragBounds.contains(b)||(b.lat=Math.max(Math.min(b.lat,this.dragBounds.getNorth()),this.dragBounds.getSouth()),b.lng=Math.max(Math.min(b.lng,this.dragBounds.getEast()),this.dragBounds.getWest())),this.isMoving){var c=this._map.latLngToContainerPoint(b);this.center=c.x,this.middle=c.y}else{var d=this._map.latLngToContainerPoint(this.fixedMarker.getLatLng()),e=this._map.latLngToContainerPoint(b);this.pixelWidth=Math.abs(d.x-e.x),this.pixelHeight=Math.abs(d.y-e.y),this.pixelWidth=Math.max(this.pixelWidth,this.pixelHeight*this.whRatio),this.pixelHeight=Math.max(this.pixelHeight,this.pixelWidth/this.whRatio)}this._update()},_marker_onDragEnd:function(){this.dragMarker=null,this.fixedMarker=this.centerMarker,this.isMoving=!1}}),b.printRectangle=function(a){return new b.PrintRectangle(a)},a(function(){a("html").addClass("no-"+m)})}(jQuery,L,this,document);