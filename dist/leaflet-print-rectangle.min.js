!function(a,b,c,d,e){"use strict";var f=1,g=2,h=4,i=8,j=16,k=32,l={stroke:!0,color:"white",weight:2,opacity:1,fill:!0,fillColor:"white",fillOpacity:.1,clickable:!0},m="leaflet-print-rectangle";b.PrintRectangle=b.Class.extend({includes:b.Mixin.Events,options:{VERSION:"1.0.2",ratio:1.5,allowRotate:!0,markerDim:20},initialize:function(a){b.setOptions(this,a),this.initSizeRatio=.9,this.minimumDim=3.6*this.options.markerDim,this.whRatio=this.options.ratio},addTo:function(c){this.map=c,a("html").removeClass("no-"+m),a("html").addClass(m);var d=c.getBounds();this.polygon=new b.polygon([d.getSouthWest(),d.getNorthWest(),d.getNorthEast(),d.getSouthEast()],l);var e,n,o,p=[f,g,h],q=["left","center","right"],r=[i,j,k],s=["top","middle","bottom"],t={icon:null,clickable:!0,draggable:!0,keyboard:!0},u={iconSize:[this.options.markerDim,this.options.markerDim],iconAnchor:[0,0],className:""};this.resizeMarkers=[],this.featureGroup=b.featureGroup();for(var v=function(a,b){this.setLatLng(this._map.containerPointToLatLng([a,b]))},w=0;w<p.length;w++)for(var x=0;x<r.length;x++){var y=p[w]+r[x];y&f&&(e=0+l.weight),y&g&&(e=this.options.markerDim/2),y&h&&(e=this.options.markerDim-l.weight),y&i&&(n=0+l.weight),y&j&&(n=this.options.markerDim/2),y&k&&(n=this.options.markerDim-l.weight),u.iconAnchor=[e,n],u.className="lpr-marker "+q[w]+" "+s[x],t.icon=b.divIcon(u),o=b.marker([0,0],t),o.type=y,o._map=this.map,o.on("dragstart",this._marker_onDragStart,this),o.on("drag",this._marker_onDrag,this),o.on("dragend",this._marker_onDragEnd,this),o._setPosByLeftTop=v,this.resizeMarkers[y]=o,this.featureGroup.addLayer(o)}this.centerMarker=this.resizeMarkers[g+j],this.fixedMarker=this.centerMarker,this.polygon.addTo(this.map),this.polygon.bringToFront(),this.featureGroup.addTo(this.map),this._container=b.DomUtil.create("div","lpr-container",this.map._controlContainer),this._topShade=b.DomUtil.create("div","lpr-shade",this._container),this._bottomShade=b.DomUtil.create("div","lpr-shade",this._container),this._leftShade=b.DomUtil.create("div","lpr-shade",this._container),this._rightShade=b.DomUtil.create("div","lpr-shade",this._container),b.DomEvent.addListener(this._container,"contextmenu",b.DomEvent.stop);var z=this.map.getPixelBounds();return this.pixelWidth=this.initSizeRatio*z.getSize().x,this.pixelHeight=this.initSizeRatio*z.getSize().y,this.pixelWidth>this.pixelHeight*this.whRatio?this.pixelWidth=this.pixelHeight*this.whRatio:this.pixelHeight=this.pixelWidth/this.whRatio,this.center=(z.max.x-z.min.x)/2,this.middle=(z.max.y-z.min.y)/2,this._update(),this.setRatio(this.whRatio),this.options.allowRotate&&this.polygon.on("click",this.rotate,this),this.map.on("drag",this._onMapChange,this),this.map.on("zoomend",this._onMapZoom,this),this.map.on("moveend",this._onMapChange,this),this.map.on("resize",this._onMapChange,this),this},_update:function(){function a(a,b){a.style.display=b.width>0&&b.height>0?"block":"none",a.style.width=b.width+"px",a.style.height=b.height+"px",a.style.top=b.top+"px",a.style.left=b.left+"px",a.style.bottom=b.bottom+"px",a.style.right=b.right+"px"}var b=this.fixedMarker.type,c=this.pixelHeight/2,d=this.pixelWidth/2;b&j&&(this.top=this.middle-c,this.bottom=this.middle+c),b&g&&(this.left=this.center-d,this.right=this.center+d),b&i&&(this.bottom=this.top+this.pixelHeight),b&k&&(this.top=this.bottom-this.pixelHeight),b&f&&(this.right=this.left+this.pixelWidth),b&h&&(this.left=this.right-this.pixelWidth),this.center=this.left+(this.right-this.left)/2,this.middle=this.top+(this.bottom-this.top)/2,this.southWest=this.map.containerPointToLatLng([this.left,this.bottom]),this.northWest=this.map.containerPointToLatLng([this.left,this.top]),this.northEast=this.map.containerPointToLatLng([this.right,this.top]),this.southEast=this.map.containerPointToLatLng([this.right,this.bottom]),this.polygon.setLatLngs([this.southWest,this.northWest,this.northEast,this.southEast]),this.resizeMarkers[f+i]._setPosByLeftTop(this.left,this.top),this.resizeMarkers[f+k]._setPosByLeftTop(this.left,this.bottom),this.resizeMarkers[h+i]._setPosByLeftTop(this.right,this.top),this.resizeMarkers[h+k]._setPosByLeftTop(this.right,this.bottom),this.resizeMarkers[f+j]._setPosByLeftTop(this.left,this.middle),this.resizeMarkers[h+j]._setPosByLeftTop(this.right,this.middle),this.resizeMarkers[g+i]._setPosByLeftTop(this.center,this.top),this.resizeMarkers[g+k]._setPosByLeftTop(this.center,this.bottom),this.resizeMarkers[g+j]._setPosByLeftTop(this.center,this.middle);var e=this.map.getSize();a(this._topShade,{width:e.x,height:this.top,top:0,left:0}),a(this._bottomShade,{width:e.x,height:e.y-this.bottom,bottom:0,left:0}),a(this._leftShade,{width:this.left,height:this.pixelHeight,top:this.top,left:0}),a(this._rightShade,{width:e.x-this.right,height:this.pixelHeight,top:this.top,right:0})},_calcPointBounds:function(){var a=this.map.latLngToContainerPoint(this.polygon.getBounds().getNorthWest()),b=this.map.latLngToContainerPoint(this.polygon.getBounds().getSouthEast());this.left=a.x,this.top=a.y,this.right=b.x,this.bottom=b.y,this.center=this.left+(this.right-this.left)/2,this.middle=this.top+(this.bottom-this.top)/2,this.pixelWidth=this.right-this.left,this.pixelHeight=this.bottom-this.top},_calcDrawPointBounds:function(){this.maxBounds=this.map.options.maxBounds?this.map.options.maxBounds:b.latLngBounds([-90,180],[90,-180]);var a=this.map.latLngToContainerPoint(this.maxBounds.getNorthWest()),c=this.map.latLngToContainerPoint(this.maxBounds.getSouthEast());this.dragLeft=a.x,this.dragTop=a.y,this.dragRight=c.x,this.dragBottom=c.y,this.dragWidth=this.dragRight-this.dragLeft,this.dragHeight=this.dragBottom-this.dragTop},_onMapChange:function(){this._calcPointBounds(),this._update()},_onMapZoom:function(){this.setRatio(this.whRatio)},_marker_onDragStart:function(a){this.dragMarker=a.target,this.isMoving=this.dragMarker==this.centerMarker,this._calcPointBounds(),this._calcDrawPointBounds();var c,d,e,l,m=this.pixelHeight/2,n=this.pixelWidth/2;this.isMoving?(this.dragLeft+=n,this.dragTop+=m,this.dragRight-=n,this.dragBottom-=m):(c=this.dragMarker.type,d=(c&g+j)+(c&i?k:0)+(c&k?i:0)+(c&f?h:0)+(c&h?f:0),this.fixedMarker=this.resizeMarkers[d],c=a.target.type,c&i&&(e=this.pixelHeight+this.top-this.dragTop),c&k&&(e=this.pixelHeight+this.dragBottom-this.bottom),c&j&&(e=this.pixelHeight+2*Math.min(this.top-this.dragTop,this.dragBottom-this.bottom)),c&f&&(l=this.pixelWidth+this.left-this.dragLeft),c&h&&(l=this.pixelWidth+this.dragRight-this.right),c&g&&(l=this.pixelWidth+2*Math.min(this.left-this.dragLeft,this.dragRight-this.right)),l>e*this.whRatio?l=e*this.whRatio:e=l/this.whRatio,c&i&&(this.dragBottom=this.bottom-this.minHeight,this.dragTop=this.bottom-e),c&k&&(this.dragTop=this.top+this.minHeight,this.dragBottom=this.top+e),c&f&&(this.dragLeft=this.right-l,this.dragRight=this.right-this.minWidth),c&h&&(this.dragLeft=this.left+this.minWidth,this.dragRight=this.left+l),c&g&&(this.dragLeft=this.center,this.dragRight=this.center),c&j&&(this.dragTop=this.middle,this.dragBottom=this.middle)),this.dragBounds=b.latLngBounds(this.map.containerPointToLatLng([this.dragLeft,this.dragBottom]),this.map.containerPointToLatLng([this.dragRight,this.dragTop]))},_marker_onDrag:function(a){var b=a.target.getLatLng();if(this.dragBounds.contains(b)||(b.lat=Math.max(Math.min(b.lat,this.dragBounds.getNorth()),this.dragBounds.getSouth()),b.lng=Math.max(Math.min(b.lng,this.dragBounds.getEast()),this.dragBounds.getWest())),this.isMoving){var c=this.map.latLngToContainerPoint(b);this.center=c.x,this.middle=c.y}else{var d=this.map.latLngToContainerPoint(this.fixedMarker.getLatLng()),e=this.map.latLngToContainerPoint(b);this.pixelWidth=Math.abs(d.x-e.x),this.pixelHeight=Math.abs(d.y-e.y),this.pixelWidth=Math.max(this.pixelWidth,this.pixelHeight*this.whRatio),this.pixelHeight=Math.max(this.pixelHeight,this.pixelWidth/this.whRatio)}this._update()},_marker_onDragEnd:function(){this.dragMarker=null,this.fixedMarker=this.centerMarker,this.isMoving=!1},setRatio:function(a,b){b&&(this.isLandscape&&1>a||!this.isLandscape&&a>=1)&&(a=1/a),this.whRatio=a,this.isLandscape=a>=1,this._calcPointBounds(),this.whRatio>1?(this.minHeight=this.minimumDim,this.minWidth=this.minHeight*this.whRatio):(this.minWidth=this.minimumDim,this.minHeight=this.minWidth/this.whRatio);var c=Math.max(this.pixelWidth,this.pixelHeight);this.whRatio<1?(this.pixelHeight=c,this.pixelWidth=this.pixelHeight*this.whRatio):(this.pixelWidth=c,this.pixelHeight=this.pixelWidth/this.whRatio),this._calcDrawPointBounds(),this.pixelHeight=Math.max(this.minHeight,Math.min(this.pixelHeight,this.dragHeight)),this.pixelWidth=Math.max(this.minWidth,Math.min(this.pixelWidth,this.dragWidth)),this.pixelWidth>this.pixelHeight*this.whRatio?this.pixelWidth=this.pixelHeight*this.whRatio:this.pixelHeight=this.pixelWidth/this.whRatio,this._update(),this.maxBounds.contains(this.polygon.getBounds())||(this.middle=this.middle+Math.max(0,this.dragTop-this.top)-Math.max(0,this.bottom-this.dragBottom),this.center=this.center+Math.max(0,this.dragLeft-this.left)-Math.max(0,this.right-this.dragRight),this._update())},rotate:function(){this.setRatio(1/this.whRatio)},remove:function(){a("html").removeClass(m),a("html").addClass("no-"+m),this.map.off("zoomend",this._onMapZoom,this),this.map.off("moveend",this._onMapChange,this),this.map.off("resize",this._onMapChange,this),this.map.off("drag",this._onMapChange,this),this.map.removeLayer(this.featureGroup),this.map.removeLayer(this.polygon),this._container.remove()}}),b.printRectangle=function(a){return new b.PrintRectangle(a)},a(function(){a("html").addClass("no-"+m)})}(jQuery,L,this,document);